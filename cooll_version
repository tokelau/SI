#include <stdio.h> // Стандартная библиотека для ввода-вывода
#include <dirent.h> // Библиотека работы с директориями
#include <string.h>

#define ENCODE_CRUFT 0

// Можно наделать таких блоков для каждого варианта,
// и потом переключать значения макроса ENCODE_CRUFT

    #define AP_L 224 //ПРОВЕРИТЬ
    #define AP_R 255
    #define CAPS_L 192
    #define CAPS_R 223


/*  Заклинания
    Создаём переменные, необходимые для работы с библиотеками
*/
DIR *dir;
struct dirent *ent;

/*  Функция, которая обрабатывает файл */
void filework (char *filename)
{
    char newfilename[80];
    strcpy(newfilename, "C:\\qwer\\");
    strcat(newfilename, filename);
    int c; // В эту переменную будут писаться символы из файла
    FILE *ff; // Это переменная для файла
    if (filename[0] != '.') // Игнорируем файлы, которые начинаются с точки
    {
        printf ("%s\n", newfilename); //Что-то делаем с прочитанными символами, в данном случае — перепечатываем в терминал.

        ff = fopen (newfilename, "r"); //Открываем файл для чтения
        while (( c = fgetc ( ff )) != EOF)  // Читаем символы по одному
        {
            printf("%c",c);
        }
        printf("\n\n");
        fclose (ff); // Когда прочитали все символы, закрываем файл
    }
}

int main(void)
{
    if ((dir = opendir ("C:\\qwer")) == NULL) // Открываем директорию.
    {
        printf ("Error while opening directory"); //Если директория не нашлась, пишем сообщение об ошибке.
        return 1;
    }
    else //Если всё хорошо, идём дальше
    {
        while ((ent = readdir (dir)) != NULL) //Читаем следующее имя файла в директории. Оно будет равно NULL, если файлы закончиились.
        {
        /*  *ent).d_name или ent -> d_name это функция, которая возвращает строку, в которой записано имя файла.
            Эту строку мы передаём нашей функции, filework
        */
            filework ((*ent).d_name);
        }
        closedir (dir); //Когда все файлы обработаны, закрываем директорию.
        printf ("Done!\n"); //Пишем что-нибудь на прощание.
    }
}
